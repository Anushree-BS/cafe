<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DairyFresh • Cart</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{--bg:#f6f7fb; --card:#fff; --muted:#6b7280; --accent:#0b1320; --accent-2:#0b7a66; --glass:rgba(11,19,32,0.04); --radius:12px;}
  *{box-sizing:border-box;font-family:Inter,system-ui,Arial;}
  body{margin:0;background:var(--bg);color:var(--accent);min-height:100vh;}
  header{display:flex;align-items:center;justify-content:space-between;padding:18px 48px;}
  .brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--accent)}
  main{padding:24px 48px}
  .container{max-width:980px;margin:0 auto}
  table{width:100%;border-collapse:collapse;background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 12px 30px var(--glass)}
  th,td{padding:16px;text-align:left}
  th{background:#f9fafb;color:var(--muted);font-weight:700}
  tr + tr td{border-top:1px solid rgba(11,19,32,0.04)}
  .thumb{width:100px;height:70px;object-fit:cover;border-radius:8px}
  .muted{color:var(--muted)}
  .totals{display:flex;justify-content:flex-end;margin-top:18px;gap:18px;align-items:center}
  .btn{padding:12px 18px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
  .checkout{background:var(--accent-2);color:white}
  .clear{background:transparent;border:1px solid rgba(11,19,32,0.06)}
  .qty{width:72px;padding:8px;border-radius:8px;border:1px solid rgba(11,19,32,0.06)}
  .empty{padding:40px;text-align:center;background:var(--card);border-radius:12px;box-shadow:0 12px 30px var(--glass)}
  footer{padding:20px 48px;color:var(--muted)}
</style>
</head>
<body>
<header>
  <a class="brand" href="index.html" style="text-decoration:none;color:inherit">
    <svg width="44" height="44" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="#0b1320" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><path d="M12 30c0-6 6-12 13-12 3 0 6 .9 8.5 2.6C36 22 39 23 42 23c6 0 12 6 12 12 0 3-1 6-3 8-3 3-9 5-16 5H24c-6 0-12-5-12-10 0-3 0-6 3-8z"/></g></svg>
  </a>

  <div style="display:flex;gap:12px;align-items:center">
    <a href="products.html" class="btn clear" style="text-decoration:none">Continue shopping</a>
    <a href="payment.html" class="btn checkout" id="topCheckout">Checkout</a>
  </div>
</header>

<main>
  <div class="container" id="container">
    <!-- injected -->
  </div>
</main>

<footer>© <span id="year3"></span> DairyFresh</footer>

<script>
function safeParse(k){ try{ return JSON.parse(localStorage.getItem(k)||'[]'); }catch(e){ console.error('localStorage parse error', e); return []; } }

function loadCart(){
  const container = document.getElementById('container');
  const cart = safeParse('df_cart');
  if(!cart.length){
    container.innerHTML = `<div class="empty"><h2>Your cart is empty</h2><p class="muted">Add delicious dairy products from the catalog.</p><div style="margin-top:18px"><a href="products.html" class="btn checkout" style="text-decoration:none">Browse products</a></div></div>`;
    updateBadge();
    return;
  }

  let html = `<table><thead><tr><th>Product</th><th style="width:120px">Price</th><th style="width:120px">Qty</th><th style="width:160px">Subtotal</th><th style="width:70px"></th></tr></thead><tbody>`;
  cart.forEach((it,idx)=>{
    const imgSafe = it.img && typeof it.img==='string' ? it.img : 'https://via.placeholder.com/300x200?text=No+image';
    html += `<tr data-idx="${idx}">
      <td style="display:flex;gap:14px;align-items:center">
        <img class="thumb" src="${imgSafe}" alt="${it.title}" onerror="this.src='https://via.placeholder.com/300x200?text=No+image'">
        <div>
          <div style="font-weight:700">${it.title}</div>
          <div class="muted">ID: ${it.id}</div>
        </div>
      </td>
      <td>₹${(it.price||0).toFixed(0)}</td>
      <td><input class="qty" type="number" min="1" value="${it.qty||1}" data-id="${it.id}" /></td>
      <td class="sub">₹${((it.price||0)*(it.qty||1)).toFixed(0)}</td>
      <td><button class="btn clear remove" data-id="${it.id}">Remove</button></td>
    </tr>`;
  });
  html += `</tbody></table>`;

  const total = cart.reduce((s,i)=>s + (i.price||0)*(i.qty||1), 0);
  html += `<div class="totals"><div style="font-weight:700;font-size:18px">Total: ₹${total.toFixed(0)}</div></div>`;
  html += `<div style="display:flex;justify-content:flex-end;margin-top:18px;gap:12px"><button class="btn clear" id="clearBtn">Clear Cart</button><a href="payment.html" class="btn checkout" id="checkoutBtn">Proceed to Payment</a></div>`;

  container.innerHTML = html;

  document.querySelectorAll('.qty').forEach(inp=>{
    inp.addEventListener('change', (e)=>{
      const id = e.target.getAttribute('data-id');
      const v = Math.max(1, parseInt(e.target.value||1,10));
      updateQty(id, v);
    });
  });
  document.querySelectorAll('.remove').forEach(btn=>{
    btn.addEventListener('click', ()=> removeItem(btn.getAttribute('data-id')));
  });
  document.getElementById('clearBtn').addEventListener('click', clearCart);
  updateBadge();
}

function updateQty(id, qty){
  let cart = safeParse('df_cart');
  cart = cart.map(it => it.id===id ? {...it, qty:qty} : it);
  localStorage.setItem('df_cart', JSON.stringify(cart));
  loadCart();
}

function removeItem(id){
  let cart = safeParse('df_cart');
  cart = cart.filter(it=>it.id!==id);
  localStorage.setItem('df_cart', JSON.stringify(cart));
  loadCart();
}

function clearCart(){
  if(!confirm('Clear the cart?')) return;
  localStorage.removeItem('df_cart');
  loadCart();
}

function updateBadge(){
  const cart = safeParse('df_cart');
  const count = cart.reduce((s,i)=>s+(i.qty||1),0);
  const badge = document.getElementById('badge') || document.querySelector('#badge');
  if(badge) badge.textContent = count;
  document.getElementById('topCheckout').style.display = cart.length ? 'inline-block' : 'none';
}

loadCart();
document.getElementById('year3').textContent = new Date().getFullYear();
</script>
</body>
</html>
